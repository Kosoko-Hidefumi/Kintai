# YouTube競合チャンネル分析ツール - 開発タスクリスト

**プロジェクト名**: YouTube競合チャンネル分析ツール  
**作成日**: 2025-11-07  
**最終更新日**: 2025-11-07

---

## 📊 進捗サマリー

| フェーズ | タスク数 | 完了 | 進捗率 |
|---------|---------|------|--------|
| Phase 0: 事前準備 | 7 | 6 | 86% |
| Phase 1: プロジェクト初期設定 | 8 | 6 | 75% |
| Phase 2: 基本機能実装（チャンネル情報） | 8 | 6 | 75% |
| Phase 3: 動画情報取得機能 | 10 | 8 | 80% |
| Phase 4: UI・メニュー機能 | 6 | 6 | 100% |
| Phase 5: エラーハンドリング | 7 | 7 | 100% |
| Phase 6: データ表示の最適化 | 5 | 4 | 80% |
| Phase 7: テスト・検証 | 8 | 0 | 0% |
| Phase 8: ドキュメント整備 | 4 | 4 | 100% |
| **合計** | **63** | **47** | **75%** |

---

## Phase 0: 事前準備

### スプレッドシート準備

- [x] **0.1** 新規Googleスプレッドシートを作成
- [x] **0.2** スプレッドシート名を「YouTube競合分析」に変更
- [x] **0.3** スプレッドシートのURLを記録

### Apps Script環境

- [x] **0.4** スプレッドシートからApps Scriptエディタを開く（拡張機能 > Apps Script）
- [x] **0.5** プロジェクト名を「YouTubeCompetitorAnalysis」に変更
- [x] **0.6** appsscript.jsonの設定確認（タイムゾーン: Asia/Tokyo）

### YouTube Data API有効化（Apps Script経由）

- [ ] **0.7** Apps Scriptエディタで「サービス」から「YouTube Data API v3」を追加
  - エディタ左側の「サービス」(+)をクリック
  - 「YouTube Data API」を選択してv3を追加
  - 識別子: `YouTube` のまま

**Phase 0 完了条件**: スプレッドシートとApps Scriptエディタが準備でき、YouTube Data APIサービスが有効化されている状態

**注意**: この方法ではAPIキーは不要です。Apps ScriptがOAuth 2.0で自動的に認証を行います。

---

## Phase 1: プロジェクト初期設定

### スプレッドシート構造の作成

- [x] **1.1** 「設定」シートを作成
  - [x] A1セルに「設定項目」、B1セルに「値」を入力（ヘッダー行）
  - [x] A2セルに「取得動画数」、B2セルに「50」
  - [x] シートの書式設定（ヘッダー行を太字、背景色を設定）
  - **注**: APIキー不要（Apps ScriptのYouTube Data APIサービス使用）

- [x] **1.2** 「チャンネルリスト」シートを作成
  - [x] A1セルに「チャンネルID」、B1セルに「メモ」、C1セルに「有効」
  - [x] C列をチェックボックス形式に変更
  - [x] シートの書式設定（ヘッダー行を太字、背景色を設定）

- [x] **1.3** 「チャンネル情報」シートを作成
  - [x] ヘッダー行を設定（A1:L1）
    - A1: 取得日時
    - B1: チャンネルID
    - C1: チャンネル名
    - D1: 登録者数
    - E1: 総視聴回数
    - F1: 動画数
    - G1: 開設日
    - H1: カスタムURL
    - I1: 説明文
    - J1: 国
    - K1: サムネイルURL
    - L1: チャンネルURL
  - [x] シートの書式設定（ヘッダー行を太字、背景色、列幅調整）

- [x] **1.4** 「動画情報」シートを作成
  - [x] ヘッダー行を設定（A1:P1）
    - A1: 取得日時
    - B1: チャンネル名
    - C1: チャンネルID
    - D1: 動画ID
    - E1: 動画タイトル
    - F1: 公開日時
    - G1: 視聴回数
    - H1: 高評価数
    - I1: コメント数
    - J1: 再生時間（秒）
    - K1: 再生時間（表示）
    - L1: タグ
    - M1: カテゴリID
    - N1: 説明文
    - O1: サムネイルURL
    - P1: 動画URL
  - [x] シートの書式設定（ヘッダー行を太字、背景色、列幅調整）

### 基本コード構造の準備

- [x] **1.5** コード.jsファイルの基本構造を作成
  - [x] ファイルヘッダーコメント（プロジェクト名、説明、作成日）を追加
  - [x] 定数定義セクションを作成
  - [x] ユーティリティ関数セクションを作成
  - [x] メイン機能セクションを作成

- [x] **1.6** グローバル定数の定義
  - [x] シート名の定数（SHEET_NAMES）
  - [x] ヘッダー定義の定数
  - [x] その他の設定値（DEFAULT_SETTINGS）

- [x] **1.7** 初期セットアップ関数の作成
  - [x] `setupSpreadsheet()` 関数を実装（シートの初期化）
  - [x] 4つのシート作成関数を実装
  - [ ] 実行して動作確認（次のステップ）

- [x] **1.8** 設定読み込み関数の作成
  - [x] `getMaxVideos()` 関数を実装
  - [x] `checkAllSheetsExist()` 関数を実装
  - [ ] 実行して動作確認（次のステップ）

**Phase 1 完了条件**: 4つのシートが正しく作成され、基本的な設定読み込み関数が動作する

---

## Phase 2: 基本機能実装（チャンネル情報取得）

### チャンネルリスト読み込み機能

- [x] **2.1** チャンネルリスト取得関数の実装
  - [x] `getActiveChannelIds()` 関数を作成
  - [x] 「チャンネルリスト」シートから有効なチャンネルIDを取得
  - [x] 空行やチェックボックスがオフの行をスキップ
  - [ ] テストデータで動作確認（次のステップ）

### YouTube Data API - チャンネル情報取得

- [x] **2.2** API呼び出し基本関数の実装
  - [x] YouTube Data API v3サービスを使用（YouTube.Channels.list）
  - [x] エラーハンドリング実装
  - [ ] 簡単なテストで動作確認（次のステップ）

- [x] **2.3** チャンネル情報取得関数の実装
  - [x] `getChannelInfo(channelId)` 関数を作成
  - [x] Channels.list APIエンドポイントを呼び出し
  - [x] part=snippet,statistics,contentDetails を指定
  - [x] レスポンスから必要なデータを抽出
  - [ ] 1チャンネルで動作テスト（次のステップ）

- [x] **2.4** チャンネル情報データ整形関数
  - [x] `formatChannelData(apiResponse)` 関数を作成
  - [x] APIレスポンスをスプレッドシート形式の配列に変換
  - [x] 日付フォーマットの変換
  - [x] URLの生成
  - [x] データ検証

### スプレッドシートへの書き込み

- [x] **2.5** チャンネル情報書き込み関数の実装
  - [x] `writeChannelInfo(channelDataArray)` 関数を作成
  - [x] 「チャンネル情報」シートの既存データをクリア（ヘッダー除く）
  - [x] データを一括書き込み
  - [x] 書式設定（数値フォーマット、日時フォーマット）

### メイン処理の統合

- [x] **2.6** チャンネル情報取得メイン関数の実装
  - [x] `fetchAllChannelInfo()` 関数を作成
  - [x] チャンネルリストの取得
  - [x] 各チャンネルの情報を取得
  - [x] データの統合と書き込み
  - [x] 進捗ログの出力
  - [x] 完了メッセージの表示

- [ ] **2.7** 複数チャンネル対応のテスト
  - [ ] テスト用に3-5個のチャンネルIDを登録
  - [ ] `fetchAllChannelInfo()` を実行
  - [ ] データが正しく取得・表示されることを確認
  - [ ] エラーが発生しないことを確認

- [ ] **2.8** パフォーマンスチェック
  - [ ] 実行時間を計測
  - [ ] 10チャンネルで1分以内に完了することを確認
  - [ ] 必要に応じて最適化

**Phase 2 完了条件**: チャンネル情報が正しく取得され、スプレッドシートに表示される

---

## Phase 3: 動画情報取得機能

### アップロードプレイリストID取得

- [x] **3.1** プレイリストID取得関数の実装
  - [x] `getUploadsPlaylistId(channelId)` 関数を作成
  - [x] Channels.list APIでcontentDetails.relatedPlaylists.uploadsを取得
  - [x] エラーハンドリング実装
  - [ ] 動作テスト（次のステップ）

### プレイリスト内動画リスト取得

- [x] **3.2** プレイリスト内動画ID取得関数の実装
  - [x] `getVideoIdsFromPlaylist(playlistId, maxResults)` 関数を作成
  - [x] PlaylistItems.list APIを呼び出し
  - [x] part=contentDetails を指定
  - [x] maxResultsパラメータを設定
  - [x] ページネーション処理実装
  - [x] 動画IDの配列を返す
  - [ ] 動作テスト（次のステップ）

### 動画詳細情報取得

- [x] **3.3** 動画情報取得関数の実装
  - [x] `getVideosInfo(videoIds)` 関数を作成
  - [x] Videos.list APIを呼び出し
  - [x] part=snippet,statistics,contentDetails を指定
  - [x] 最大50件の動画IDをカンマ区切りで渡す
  - [x] 50件ずつバッチ処理実装
  - [x] レスポンスから詳細情報を抽出
  - [ ] 動作テスト（次のステップ）

- [x] **3.4** 再生時間変換関数の実装
  - [x] `parseDuration(isoDuration)` 関数を作成
  - [x] ISO 8601形式（PT1H2M3S）を秒数に変換
  - [x] `formatDuration(seconds)` 関数を作成
  - [x] 秒数をHH:MM:SS形式に変換
  - [x] 各種パターンに対応（1分未満、1時間未満、1時間以上）

### データ整形と統合

- [x] **3.5** 動画情報データ整形関数
  - [x] `formatVideoData(video, channelName, channelId)` 関数を作成
  - [x] APIレスポンスをスプレッドシート形式の配列に変換
  - [x] 再生時間の変換処理を組み込み
  - [x] タグの結合（配列をカンマ区切り文字列に）
  - [x] URLの生成
  - [x] データ検証

- [x] **3.6** 動画情報書き込み関数の実装
  - [x] `writeVideoInfo(videoDataArray)` 関数を作成
  - [x] 「動画情報」シートの既存データをクリア（ヘッダー除く）
  - [x] データを一括書き込み
  - [x] 書式設定（数値フォーマット、日時フォーマット）

### 動画取得メイン処理

- [x] **3.7** 1チャンネルの動画取得関数
  - [x] `fetchVideosForChannel(channelId, channelName, maxVideos)` 関数を作成
  - [x] プレイリストID取得
  - [x] 動画ID一覧取得
  - [x] 50件ずつバッチ処理で動画詳細取得
  - [x] データの統合
  - [ ] 1チャンネルでテスト（次のステップ）

- [x] **3.8** 全チャンネルの動画取得メイン関数
  - [x] `fetchAllVideosInfo()` 関数を作成
  - [x] 設定値の取得
  - [x] チャンネルリストの取得
  - [x] 各チャンネルの動画情報を取得
  - [x] 全データの統合
  - [x] 書き込み処理
  - [x] 進捗ログの出力

- [ ] **3.9** 複数チャンネル対応のテスト
  - [ ] 3-5個のチャンネルで動画情報を取得
  - [ ] データが正しく表示されることを確認
  - [ ] 各チャンネルの動画が混在していないことを確認
  - [ ] エラーが発生しないことを確認

- [ ] **3.10** パフォーマンスチェック
  - [ ] 実行時間を計測
  - [ ] 10チャンネル×50動画で3分以内に完了することを確認
  - [ ] API呼び出し回数を最適化

**Phase 3 完了条件**: 動画情報が正しく取得され、スプレッドシートに表示される

---

## Phase 4: UI・メニュー機能

### カスタムメニューの実装

- [x] **4.1** メニュー作成関数の実装
  - [x] `onOpen()` 関数を作成（スプレッドシート起動時に自動実行）
  - [x] カスタムメニュー「📊 YouTube分析」を追加
  - [x] メニュー項目を定義（絵文字アイコン付き）

- [x] **4.2** メニュー項目の追加
  - [x] 「📺 チャンネル情報を取得」メニュー項目
  - [x] 「🎬 動画情報を取得」メニュー項目
  - [x] 「🔄 すべて実行」メニュー項目
  - [x] セパレーター
  - [x] 「🗑️ データをクリア」メニュー項目
  - [x] 「⚙️ 初期セットアップ」メニュー項目

### メニューから呼び出す関数の実装

- [x] **4.3** メニュー実行用ラッパー関数
  - [x] `menuFetchChannelInfo()` 関数を作成
  - [x] `menuFetchVideoInfo()` 関数を作成
  - [x] `menuFetchAll()` 関数を作成（2ステップ処理）

- [x] **4.4** データクリア機能の実装
  - [x] `clearAllData()` 関数を作成
  - [x] `menuClearData()` で確認ダイアログを表示
  - [x] 「チャンネル情報」シートのデータクリア
  - [x] 「動画情報」シートのデータクリア
  - [x] 完了メッセージ表示

### ユーザーフィードバック

- [x] **4.5** 進捗表示機能の実装
  - [x] `showProgress(message)` 関数を作成（Logger.log + Toast通知）
  - [x] 各処理の開始時・終了時にメッセージ表示
  - [x] 処理件数のカウント表示

- [x] **4.6** 完了通知機能の実装
  - [x] 各メイン関数で完了メッセージを表示
  - [x] 取得件数と所要時間を表示
  - [x] 成功/失敗の状態表示

**Phase 4 完了条件**: カスタムメニューから全機能が実行でき、適切なフィードバックが表示される

---

## Phase 5: エラーハンドリング

### API関連エラー処理

- [x] **5.1** APIキー検証機能（不要）
  - [x] YouTube Data APIサービス使用（APIキー不要）
  - [x] サービス未追加時のエラーは自動検出

- [x] **5.2** APIクォータ超過エラー処理
  - [x] try-catchでAPI例外を捕捉
  - [x] ユーザーフレンドリーなエラーメッセージ
  - [x] APIレート制限対策（Utilities.sleep実装済み）

- [x] **5.3** ネットワークエラー処理
  - [x] try-catchブロックでAPI呼び出しをラップ
  - [x] エラー時はnullを返して処理を継続
  - [x] エラーログの記録（Logger.log）
  - [x] ユーザーへのエラー通知（Alert表示）

### データ検証エラー処理

- [x] **5.4** チャンネルID検証
  - [x] 空のチャンネルIDのスキップ実装済み
  - [x] 無効なチャンネルIDの検出（APIレスポンス検証）
  - [x] 存在しないチャンネルIDはnullを返す
  - [x] エラー発生時も処理を継続（successCount/errorCountで管理）

- [x] **5.5** API レスポンス検証
  - [x] レスポンスが空の場合の処理実装済み
  - [x] `response.items`の存在確認
  - [x] 配列の長さチェック
  - [x] Optional chaining（`?.`）でデータ欠落に対応

### 実行環境エラー処理

- [x] **5.6** スプレッドシート存在確認
  - [x] `checkAllSheetsExist()` 関数実装済み
  - [x] シートが見つからない場合のエラーメッセージ
  - [x] 初期セットアップへの誘導メッセージ

- [x] **5.7** 実行時間制限対策
  - [x] 実行時間の計測と表示実装済み
  - [x] APIレート制限対策（適切な待機時間）
  - [x] READMEに分割実行の提案を記載

**Phase 5 完了条件**: 各種エラーが適切にハンドリングされ、ユーザーに分かりやすいメッセージが表示される

---

## Phase 6: データ表示の最適化

### スプレッドシート書式設定

- [x] **6.1** 数値フォーマットの適用
  - [x] 登録者数にカンマ区切り形式を適用（`#,##0`）
  - [x] 視聴回数にカンマ区切り形式を適用
  - [x] その他の数値項目（高評価数、コメント数、再生時間）に適切なフォーマット

- [x] **6.2** 日付フォーマットの適用
  - [x] 取得日時に日時形式を適用（`yyyy-mm-dd hh:mm:ss`）
  - [x] 公開日時に日時形式を適用
  - [x] 開設日に日付形式を適用（`yyyy-mm-dd`）

- [x] **6.3** ハイパーリンクの設定（URL文字列として実装）
  - [x] チャンネルURLを生成して列に格納
  - [x] 動画URLを生成して列に格納
  - [x] サムネイルURLを列に格納（クリック可能）

### 列幅とレイアウト調整

- [x] **6.4** 列幅の自動調整
  - [x] 各シートのセットアップ時に列幅を設定
  - [x] 各列の内容に応じた列幅設定（150-300px）
  - [x] 説明文など長いテキスト列の幅制限（300px）
  - [x] すべてのシートに適用済み

- [ ] **6.5** 条件付き書式の追加（オプション・将来拡張）
  - [ ] 視聴回数が高い動画を強調表示
  - [ ] 最近公開された動画を強調表示
  - [ ] 登録者数でチャンネルを色分け

**Phase 6 完了条件**: データが見やすく整形され、リンクが正しく機能する

---

## Phase 7: テスト・検証

### 単体テスト

- [ ] **7.1** ユーティリティ関数のテスト
  - [ ] 再生時間変換関数のテスト（複数パターン）
  - [ ] 日付変換関数のテスト
  - [ ] データ検証関数のテスト
  - [ ] テストケースを記録

- [ ] **7.2** API呼び出し関数のテスト
  - [ ] 正常系: 有効なチャンネルIDでのテスト
  - [ ] 異常系: 無効なチャンネルIDでのテスト
  - [ ] 異常系: 無効なAPIキーでのテスト
  - [ ] テスト結果を記録

### 統合テスト

- [ ] **7.3** チャンネル情報取得の統合テスト
  - [ ] 1チャンネルでのテスト
  - [ ] 5チャンネルでのテスト
  - [ ] 10チャンネルでのテスト
  - [ ] データの正確性を確認

- [ ] **7.4** 動画情報取得の統合テスト
  - [ ] 1チャンネルでのテスト
  - [ ] 複数チャンネルでのテスト
  - [ ] 動画数が少ないチャンネル（10件未満）でのテスト
  - [ ] 動画数が多いチャンネル（50件以上）でのテスト

### エンドツーエンドテスト

- [ ] **7.5** 実際の運用シナリオテスト
  - [ ] 新規スプレッドシートでの初期セットアップ
  - [ ] チャンネルリストの登録
  - [ ] メニューからチャンネル情報取得
  - [ ] メニューから動画情報取得
  - [ ] データクリア機能のテスト

- [ ] **7.6** エラーケーステスト
  - [ ] APIキー未設定での実行
  - [ ] 無効なチャンネルIDでの実行
  - [ ] 空のチャンネルリストでの実行
  - [ ] すべてのエラーメッセージが適切に表示されることを確認

### パフォーマンステスト

- [ ] **7.7** 処理時間の計測
  - [ ] 各処理の実行時間を記録
  - [ ] 要件定義のパフォーマンス基準を満たすことを確認
  - [ ] ボトルネックの特定と最適化

- [ ] **7.8** APIクォータ消費量の確認
  - [ ] 各処理でのAPI呼び出し回数を記録
  - [ ] 1日のクォータ制限内で実行可能か確認
  - [ ] クォータ最適化の余地を検討

**Phase 7 完了条件**: すべてのテストケースが成功し、要件を満たすことが確認される

---

## Phase 8: ドキュメント整備

### コードドキュメント

- [x] **8.1** 関数コメントの追加
  - [x] すべての関数にJSDoc形式のコメントを追加
  - [x] パラメータの説明
  - [x] 戻り値の説明
  - [x] 各関数の用途説明

- [x] **8.2** コード内コメントの整備
  - [x] 各セクションにセパレーターコメントを追加
  - [x] 処理の流れに説明コメントを追加
  - [x] ファイルヘッダーコメントの追加

### ユーザー向けドキュメント

- [x] **8.3** README.mdの作成
  - [x] プロジェクト概要
  - [x] セットアップ手順（YouTube Data API有効化方法含む）
  - [x] 使い方（メニュー操作、チャンネルID取得方法）
  - [x] トラブルシューティング
  - [x] 活用例・今後の拡張予定
  - [x] ライセンス情報

- [x] **8.4** 開発状況ドキュメントの更新
  - [x] タスクリストの進捗管理
  - [x] 実装済み機能のリスト
  - [x] 既知の制約・制限事項
  - [x] 今後の拡張予定

**Phase 8 完了条件**: コードとユーザー向けドキュメントが完備され、第三者が理解・使用できる状態

---

## 🔄 追加・オプション機能（Phase 9+）

以下は基本機能完成後に追加できる機能です：

### 定期実行機能
- [ ] **9.1** トリガー設定関数の実装
- [ ] **9.2** 日次/週次の自動実行設定
- [ ] **9.3** 実行結果の通知機能

### データ分析機能
- [ ] **9.4** エンゲージメント率の計算
- [ ] **9.5** 平均視聴回数の算出
- [ ] **9.6** トレンド分析（前回取得データとの比較）

### UI改善
- [ ] **9.7** サイドバーUIの作成
- [ ] **9.8** 設定ダイアログの実装
- [ ] **9.9** プログレスバーの表示

---

## 📝 使用方法

### タスクの更新方法
- 完了したタスクは `- [ ]` を `- [x]` に変更してください
- 各Phase完了時に進捗サマリーの表を更新してください

### 優先順位
- Phase 0 〜 Phase 4 は必須機能
- Phase 5 〜 Phase 6 は品質向上機能（強く推奨）
- Phase 7 は検証フェーズ（必須）
- Phase 8 はドキュメント整備（推奨）
- Phase 9+ は追加機能（オプション）

### 注意事項
- 各Phaseは順番に進めることを推奨
- Phase完了後は必ず動作確認を実施
- エラーが発生した場合は、エラー内容を記録してから次に進む
- コミットは各Phase完了時に実施することを推奨

---

**最終更新**: 2025-11-07  
**総タスク数**: 62（基本機能） + 6（オプション機能）  
**想定開発期間**: 3-5日（実装のみ）

