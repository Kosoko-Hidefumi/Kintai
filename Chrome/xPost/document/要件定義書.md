# X投稿転送拡張機能 要件定義書

## 1. 概要

### 1.1 目的
X(Twitter)の有益なポストを簡単に Slack と Notion に転送するための Google Chrome 拡張機能を開発する。

### 1.2 背景
- Xの投稿をSlackチームやNotionのデータベースに保存する際、手動でコピー＆ペーストする手間を削減
- 情報の一元管理と効率的な情報共有の実現

### 1.3 対象ユーザー
- X(Twitter)を利用し、組織内で情報共有を行うビジネスパーソン
- 知識管理としてNotionを使用しているユーザー

## 2. 機能要件

### 2.1 主要機能

#### 2.1.1 X投稿の取得機能
- **FR-001**: X(Twitter)のWebページで動作する
- **FR-002**: 各投稿に専用アイコンを表示する
- **FR-003**: 投稿のテキスト内容を取得できる
- **FR-004**: 投稿のURLを取得できる
- **FR-005**: 投稿の投稿者情報（ユーザー名、表示名）を取得できる
- **FR-006**: 投稿の日時を取得できる

#### 2.1.2 アイコン配置機能
- **FR-008**: Xの投稿内の既存UI（ブックマーク、共有アイコン）に合わせた配置
- **FR-009**: ブックマークアイコンの左側に新しいアイコンを配置
- **FR-010**: アイコンのクリック時に処理を開始できる

#### 2.1.3 Slack連携機能
- **FR-011**: 事前設定したSlackチャンネルに投稿を送信できる
- **FR-012**: 送信内容は以下を含む：
  - 投稿テキスト
  - 投稿URL
  - 投稿者情報
  - 投稿日時
- **FR-013**: Slack APIを使用してメッセージを送信する
- **FR-014**: 送信成功・失敗をユーザーにフィードバックする

#### 2.1.4 Notion連携機能
- **FR-015**: 事前設定したNotionデータベースに投稿を追加できる
- **FR-016**: データベースのプロパティに以下の情報を追加：
  - 投稿テキスト（Title or Rich Text）
  - 投稿URL（URL）
  - 投稿者情報（Text）
  - 投稿日時（Date）
- **FR-017**: Notion APIを使用してデータを追加する
- **FR-018**: 追加成功・失敗をユーザーにフィードバックする

#### 2.1.5 設定機能
- **FR-019**: 拡張機能の設定画面を提供する
- **FR-020**: Slack APIトークンの設定ができる
- **FR-021**: SlackチャンネルIDの設定ができる
- **FR-022**: Notion APIトークンの設定ができる
- **FR-023**: NotionデータベースIDの設定ができる
- **FR-024**: 設定情報を安全に保存する（Chrome.storage を使用）

### 2.2 補助機能

#### 2.2.1 エラーハンドリング
- **FR-025**: API通信エラー時に適切なエラーメッセージを表示
- **FR-026**: 設定不備の場合の警告表示
- **FR-027**: ネットワークエラー時の再試行機能（任意）

#### 2.2.2 UI/UX機能
- **FR-028**: アイコンクリック時にローディング表示
- **FR-029**: 処理完了時の成功通知
- **FR-030**: 処理失敗時のエラー通知
- **FR-031**: Slack/Notionのどちらかに送信するか選択できる

## 3. 非機能要件

### 3.1 パフォーマンス
- **NFR-001**: アイコン表示の遅延は100ms以内
- **NFR-002**: API通信は非同期で行う
- **NFR-003**: 拡張機能はXのページ読み込みを遅延させない

### 3.2 セキュリティ
- **NFR-004**: APIトークンはChrome.storage.local に暗号化して保存
- **NFR-005**: APIトークンは平文で表示しない
- **NFR-006**: 設定画面には認証情報のマスキング表示を使用

### 3.3 互換性
- **NFR-007**: Google Chrome 最新版2バージョンに対応
- **NFR-008**: X(Twitter)の最新UIに対応
- **NFR-009**: Manifest V3を使用

### 3.4 使いやすさ
- **NFR-010**: 初期設定は1回のみで完了
- **NFR-011**: 直感的なアイコンデザイン
- **NFR-012**: 一目で送信状態がわかる視覚的フィードバック

## 4. 技術要件

### 4.1 使用技術
- **JavaScript (ES6+)**
- **Chrome Extension API**
- **Manifest V3**
- **Content Scripts**
- **Background Service Worker**

### 4.2 外部API連携
- **Slack Web API**: `https://slack.com/api/`
- **Notion API**: `https://api.notion.com/v1/`

### 4.3 データストレージ
- **Chrome.storage.local**: 設定情報の保存

### 4.4 必要な情報
- **Slack**: 
  - Bot User OAuth Token (xoxb-...)
  - Channel ID
- **Notion**: 
  - Internal Integration Token (secret_...)
  - Database ID (32桁のUUID)

## 5. UI/UX要件

### 5.1 アイコンデザイン
- **UI-001**: 他のXのUIと調和するデザイン
- **UI-002**: 16x16, 24x24, 32x32, 48x48, 128x128の複数サイズを用意
- **UI-003**: クリック時にホバーエフェクト
- **UI-004**: 処理中はローディングアニメーション
- **UI-005**: 成功時はチェックマーク表示
- **UI-006**: 失敗時はエラーアイコン表示

### 5.2 設定画面
- **UI-007**: シンプルなフォーム形式
- **UI-008**: 入力フィールドのラベルを明確に
- **UI-009**: 保存ボタンで設定を保存
- **UI-010**: テスト送信ボタンで動作確認

### 5.3 通知
- **UI-011**: Toast通知でフィードバック
- **UI-012**: 通知は3秒後に自動消去
- **UI-013**: エラー時は詳細なメッセージを表示

## 6. 統合要件

### 6.1 Slack API統合
- **INT-001**: `/api/chat.postMessage` エンドポイントを使用
- **INT-002**: Bot Token を使用して認証
- **INT-003**: リッチテキストフォーマット（Markdown）をサポート
- **INT-004**: スレッド返信に対応（オプション）

### 6.2 Notion API統合
- **INT-005**: `/v1/pages` エンドポイントを使用
- **INT-006**: Database ID を parent として指定
- **INT-007**: プロパティマッピングを設定画面で定義
- **INT-008**: リッチテキスト形式で投稿内容を保存

### 6.3 エラーレスポンス処理
- **INT-009**: Slack API エラーコードを適切に処理
- **INT-010**: Notion API エラーコードを適切に処理
- **INT-011**: Rate Limit エラー時の処理

## 7. データ要件

### 7.1 取得データ
| 項目 | 説明 | 用途 |
|------|------|------|
| 投稿テキスト | X投稿の本文 | Slack/Notionに転送 |
| 投稿URL | x.com/username/status/id | リンクとして保存 |
| 投稿者名 | 投稿者のユーザー名 | 属性情報として保存 |
| 投稿日時 | 投稿の作成日時 | データとして保存 |

### 7.2 設定データ
| 項目 | 説明 | 保存場所 |
|------|------|----------|
| Slack Token | Bot User OAuth Token | Chrome.storage.local |
| Slack Channel ID | 送信先チャンネルID | Chrome.storage.local |
| Notion Token | Internal Integration Token | Chrome.storage.local |
| Notion Database ID | 送信先データベースID | Chrome.storage.local |

## 8. セキュリティ要件

### 8.1 認証情報管理
- **SEC-001**: APIトークンは平文でログに出力しない
- **SEC-002**: Chrome.storage を使用してローカルに保存
- **SEC-003**: 設定画面では入力値のマスキング表示
- **SEC-004**: HTTPSエンドポイントのみにAPI通信

### 8.2 権限管理
- **SEC-005**: 最小限の権限のみを要求
  - `activeTab`: 現在のタブへのアクセス
  - `storage`: 設定の保存
- **SEC-006**: 許可されていないドメインでの動作を防止

## 9. 実装考慮事項

### 9.1 Content Scripts
- Xの投稿リストを監視
- 動的追加される投稿にも対応
- DOM操作でアイコンを追加

### 9.2 Background Service Worker
- API通信の処理
- 設定情報の管理
- エラーハンドリング

### 9.3 Popup UI（オプション）
- 設定画面
- 送信履歴
- 統計情報

### 9.4 既存UIへの統合
- Xのターボストリームを監視
- MutationObserver でDOM変更を検知
- 投稿ごとにアイコンを動的に追加

## 10. 制約事項と前提条件

### 10.1 前提条件
- **制約-001**: ユーザーは Slack Workspace と Notion Workspace へのアクセス権限を持つ
- **制約-002**: ユーザーは Slack Bot と Notion Integration を設定済み
- **制約-003**: ユーザーは必要なAPIトークンを取得済み

### 10.2 制約事項
- **制約-004**: XのUI変更により動作しなくなる可能性がある
- **制約-005**: Rate Limit により送信失敗する可能性がある
- **制約-006**: API トークンの有効期限切れ時の処理が必要

### 10.3 将来の拡張性
- **拡張-001**: Discord への転送
- **拡張-002**: 複数の Slack チャンネル/Notion データベースへの送信
- **拡張-003**: タグ付け機能
- **拡張-004**: 保存前に投稿内容の編集機能

## 11. テスト要件

### 11.1 機能テスト
- **TEST-001**: アイコンが正しく表示される
- **TEST-002**: クリック時にSlackに送信される
- **TEST-003**: クリック時にNotionに追加される
- **TEST-004**: エラー時に適切なメッセージが表示される

### 11.2 統合テスト
- **TEST-005**: Slack API との正常な通信
- **TEST-006**: Notion API との正常な通信
- **TEST-007**: ネットワークエラー時の処理

### 11.3 ユーザビリティテスト
- **TEST-008**: 初期設定の手順がわかりやすいか
- **TEST-009**: 送信処理が直感的か
- **TEST-010**: エラーメッセージが理解しやすいか

## 12. 開発フェーズ

### Phase 1: 基本機能
- X投稿の取得
- アイコンの表示
- Content Scripts の実装

### Phase 2: Slack統合
- Slack API との連携
- 設定機能の実装
- エラーハンドリング

### Phase 3: Notion統合
- Notion API との連携
- データベースへの追加機能
- UIの改善

### Phase 4: フィードバックと改善
- 通知機能の実装
- UI/UXの最適化
- テストとデバッグ

---

## 付録

### A. 参考情報
- [Slack Web API Documentation](https://api.slack.com/methods)
- [Notion API Documentation](https://developers.notion.com/reference)
- [Chrome Extension Documentation](https://developer.chrome.com/docs/extensions/)

### B. 用語集
- **Slack Bot**: Slack上で自動化されたタスクを実行するボット
- **Notion Integration**: Notionのデータベースに外部からデータを追加する機能
- **Content Scripts**: Webページにスクリプトを注入するChrome拡張機能の仕組み
- **Service Worker**: バックグラウンドで動作するスクリプト（Manifest V3）

