# データ分析ダッシュボード 開発手順書

## 概要

本ドキュメントは、データ分析ダッシュボードを段階的に開発するための手順書です。全体の機能を100%としたとき、30%（コア機能）→ 50% → 80% → 100%と段階的に機能を追加・拡張していきます。

## 開発フェーズ概要

| フェーズ | 完了率 | 目標 | 想定期間 |
|---------|--------|------|----------|
| Phase 1 | 30% | コア機能の実装（MVP） | 1-2週間 |
| Phase 2 | 50% | 基本機能の完成 | 1-2週間 |
| Phase 3 | 80% | 高度な機能の追加 | 2-3週間 |
| Phase 4 | 100% | 完全版の完成 | 1-2週間 |

---

## Phase 1: コア機能の実装（30%完了）

### 目標
最小限の機能で動作するダッシュボードを構築し、基本的なデータ読み込み、フィルタリング、可視化、テーブル表示を実現する。

### 実装する機能

#### 1.1 プロジェクトセットアップ
- [ ] Reactプロジェクトの作成（Vite推奨）
- [ ] MUI関連パッケージのインストール
  ```bash
  npm install @mui/material @mui/icons-material @emotion/react @emotion/styled
  npm install @mui/x-data-grid
  npm install recharts
  npm install papaparse
  npm install dayjs
  ```
- [ ] プロジェクト構造の作成
  ```
  src/
  ├── components/
  │   ├── Layout/
  │   ├── Filters/
  │   ├── Charts/
  │   └── Table/
  ├── contexts/
  ├── hooks/
  ├── utils/
  ├── theme/
  └── App.jsx
  ```
- [ ] ESLint、Prettierの設定

#### 1.2 MUIテーマシステムの基本設定
- [ ] `src/theme/theme.js`の作成
- [ ] ライトモードテーマの設定
- [ ] `ThemeProvider`の設定
- [ ] 基本的なカラーパレットの定義

#### 1.3 レイアウトコンポーネントの実装
- [ ] `Layout`コンポーネントの作成
  - MUI `Container`を使用した基本レイアウト
  - ヘッダーコンポーネント（タイトル表示）
  - メインコンテンツエリア
- [ ] `Grid`システムを使用したレスポンシブレイアウト（PCのみ対応）

#### 1.4 データ読み込み機能
- [ ] CSVファイル読み込みコンポーネントの実装
  - `FileInput`コンポーネント（MUI `Button`と`input[type="file"]`）
  - PapaParseを使用したCSVパース処理
  - データの型変換（数値、日付、文字列）
- [ ] データ検証機能の実装
  - 欠損値チェック
  - データ件数の表示
- [ ] ローディング表示（MUI `CircularProgress`）
- [ ] エラーハンドリング（MUI `Snackbar`と`Alert`）

#### 1.5 状態管理の実装
- [ ] React Context APIの設定
  - `DataContext`の作成（データ状態管理）
  - `FilterContext`の作成（フィルタ状態管理）
- [ ] データとフィルタの状態管理ロジック

#### 1.6 基本フィルタリング機能
- [ ] フィルタパネルコンポーネントの作成
  - MUI `Paper`を使用したサイドバー
- [ ] 性別フィルタ（MUI `RadioGroup`）
  - 男性、女性、すべての選択
- [ ] 地域フィルタ（MUI `Select`）
  - 関東、中部、関西、九州、すべての選択
- [ ] 購入カテゴリーフィルタ（MUI `Checkbox`）
  - 複数選択可能
- [ ] フィルタ適用ロジックの実装
- [ ] フィルタ適用後のデータ件数表示（MUI `Typography`）

#### 1.7 KPIカードの実装
- [ ] `KPICard`コンポーネントの作成
  - MUI `Card`コンポーネントを使用
- [ ] 主要指標の計算と表示
  - 総購入金額
  - 平均購入金額
  - 総顧客数
  - 購入件数
- [ ] `Grid`を使用したレスポンシブレイアウト（2列×2行）

#### 1.8 基本グラフの実装
- [ ] `ChartCard`コンポーネントの作成
  - MUI `Card`内にグラフを配置
- [ ] 購入カテゴリー別購入金額の棒グラフ（Recharts `BarChart`）
- [ ] 購入金額の時系列推移グラフ（Recharts `LineChart`）
  - 月別集計のみ
- [ ] グラフの基本スタイリング

#### 1.9 データテーブルの実装
- [ ] MUI X `DataGrid`コンポーネントの実装
- [ ] 列定義の設定（顧客ID、年齢、性別、地域、購入カテゴリー、購入金額、購入日、支払方法）
- [ ] ソート機能の有効化
- [ ] ページネーション機能の有効化
- [ ] 基本的なスタイリング

### 成果物
- 動作する最小限のダッシュボード
- CSVファイルを読み込んで、基本的なフィルタリングと可視化が可能
- データテーブルでソートとページネーションが可能

### テスト項目
- [ ] CSVファイルの正常な読み込み
- [ ] 各フィルタの正常動作
- [ ] グラフの正常な描画
- [ ] データテーブルのソート・ページネーション

---

## Phase 2: 基本機能の完成（50%完了）

### 目標
Phase 1で実装したコア機能を拡張し、より実用的なフィルタリング機能と可視化機能を追加する。

### 実装する機能

#### 2.1 日付範囲フィルタの実装
- [ ] MUI X Date Pickersのインストール
  ```bash
  npm install @mui/x-date-pickers
  ```
- [ ] Day.jsの設定と日本語ロケールの設定
- [ ] 日付範囲フィルタコンポーネントの実装
  - 開始日ピッカー（MUI X `DatePicker`）
  - 終了日ピッカー（MUI X `DatePicker`）
- [ ] 日付フィルタリングロジックの実装
- [ ] 日付フォーマットの統一（YYYY-MM-DD）

#### 2.2 数値範囲フィルタの実装
- [ ] 年齢範囲フィルタの実装
  - MUI `Slider`コンポーネントを使用
  - 最小値・最大値の表示（MUI `Typography`）
- [ ] 購入金額範囲フィルタの実装
  - MUI `Slider`コンポーネントを使用
  - 最小値・最大値の表示
- [ ] 数値範囲フィルタリングロジックの実装

#### 2.3 支払方法フィルタの追加
- [ ] 支払方法フィルタの実装（MUI `Checkbox`）
  - クレジットカード、電子マネー、現金の複数選択

#### 2.4 フィルタ操作機能の追加
- [ ] フィルタリセットボタンの実装（MUI `Button`）
  - すべてのフィルタを初期状態に戻す
- [ ] フィルタ適用時の自動更新機能の実装
  - `useEffect`を使用したリアクティブな更新

#### 2.5 時系列分析の強化
- [ ] 時系列グラフの集計単位切り替え機能
  - 日別、週別、月別、四半期別の切り替え（MUI `ToggleButtonGroup`）
- [ ] 購入件数の時系列推移グラフの追加
- [ ] 複数カテゴリーの比較表示機能
  - 複数系列の折れ線グラフ

#### 2.6 カテゴリ別分析の追加
- [ ] 地域別購入金額分布の棒グラフ
- [ ] 支払方法別購入金額分布の棒グラフ
- [ ] 性別購入金額分布の棒グラフ
- [ ] 購入カテゴリー別購入件数の棒グラフ

#### 2.7 エラーハンドリングとUX改善
- [ ] 詳細なエラーメッセージの実装
- [ ] ローディング状態の改善（MUI `Skeleton`の使用）
- [ ] データ読み込み完了通知の実装（MUI `Snackbar`）
- [ ] フィルタ適用時の視覚的フィードバック

#### 2.8 データテーブルの機能拡張
- [ ] 列の幅調整機能
- [ ] 列の表示/非表示機能
- [ ] テーブルのスタイリング改善

### 成果物
- 日付範囲と数値範囲によるフィルタリングが可能
- より多様なグラフ表示が可能
- ユーザーフレンドリーなエラーハンドリングとフィードバック

### テスト項目
- [ ] 日付範囲フィルタの正常動作
- [ ] 数値範囲フィルタの正常動作
- [ ] 時系列グラフの集計単位切り替え
- [ ] 複数カテゴリーの比較表示
- [ ] エラーハンドリングの動作確認

---

## Phase 3: 高度な機能の追加（80%完了）

### 目標
高度な分析機能とUI/UXの改善を実装し、プロダクションレベルの品質に近づける。

### 実装する機能

#### 3.1 相関分析の実装
- [ ] 年齢と購入金額の散布図の実装（Recharts `ScatterChart`）
  - データポイントのホバー表示
  - トレンドラインの表示（オプション）
- [ ] 地域×購入カテゴリー×購入金額のヒートマップの実装
  - Rechartsまたはカスタムコンポーネント
  - カラースケールの設定
- [ ] 性別×地域×購入金額のクロス集計表の実装
  - MUI `Table`コンポーネントを使用

#### 3.2 分布分析の実装
- [ ] 年齢の分布ヒストグラムの実装（Recharts `BarChart`）
  - ビンの設定と調整
- [ ] 購入金額の分布ヒストグラムの実装
- [ ] 年齢層別の購入金額箱ひげ図の実装
  - Rechartsまたはカスタムコンポーネント
  - 年齢層の定義（10代、20代、30代など）

#### 3.3 グラフのインタラクティブ機能
- [ ] グラフのデータポイントホバー時の詳細情報表示
  - ツールチップのカスタマイズ
- [ ] グラフの凡例クリックで系列の表示/非表示切り替え
- [ ] グラフのズーム機能（Rechartsの`Zoom`コンポーネント）
- [ ] グラフのパン機能

#### 3.4 データエクスポート機能
- [ ] CSVエクスポート機能の実装
  - MUI `Button`と`IconButton`を使用
  - PapaParseを使用したCSV生成
  - フィルタ適用後のデータのみエクスポート
- [ ] エクスポートボタンの配置（テーブル上部）

#### 3.5 レスポンシブデザインの実装
- [ ] MUI `Grid`システムを使用したレスポンシブレイアウト
  - ブレークポイントの設定（xs, sm, md, lg, xl）
- [ ] モバイル対応
  - フィルタパネルを`Drawer`に変更（モバイル時）
  - グラフのサイズ調整
  - テーブルの横スクロール対応
- [ ] タブレット対応
  - レイアウトの調整
  - グラフの配置最適化

#### 3.6 ダークモード対応
- [ ] ダークモードテーマの実装
  - `createTheme`でダークモードテーマを作成
- [ ] テーマ切り替え機能の実装
  - MUI `Switch`または`IconButton`を使用
  - `useTheme`と`ThemeProvider`を使用した切り替え
- [ ] グラフのダークモード対応
  - Rechartsのテーマ設定

#### 3.7 パフォーマンス最適化
- [ ] MUI X DataGridの仮想スクロール機能の活用
- [ ] グラフ描画の最適化
  - 大量データ時のサンプリング
  - `useMemo`を使用した計算の最適化
- [ ] フィルタ適用時のパフォーマンス改善
  - `useMemo`と`useCallback`の活用

#### 3.8 UI/UXの改善
- [ ] アニメーションとトランジションの追加
  - MUI `Fade`、`Slide`、`Grow`コンポーネントの使用
- [ ] ローディング状態の改善
  - MUI `Skeleton`の使用
- [ ] ホバーエフェクトの追加
- [ ] カードのシャドウとエレベーションの調整

### 成果物
- 高度な分析機能を持つダッシュボード
- レスポンシブデザインでモバイル・タブレット対応
- ダークモード対応
- データエクスポート機能

### テスト項目
- [ ] 相関分析グラフの正常な描画
- [ ] 分布分析グラフの正常な描画
- [ ] グラフのインタラクティブ機能の動作確認
- [ ] CSVエクスポート機能の動作確認
- [ ] レスポンシブデザインの動作確認（各種デバイス）
- [ ] ダークモードの表示確認
- [ ] パフォーマンステスト（データ読み込み時間、フィルタ適用速度）

---

## Phase 4: 完全版の完成（100%完了）

### 目標
すべての機能を実装し、プロダクションレベルの品質を達成する。

### 実装する機能

#### 4.1 グラフエクスポート機能
- [ ] グラフの画像エクスポート機能の実装
  - PNG形式でのエクスポート
  - SVG形式でのエクスポート
  - html2canvasまたはRechartsのエクスポート機能を使用
- [ ] 各グラフカードにエクスポートボタンを追加（MUI `IconButton`）

#### 4.2 プリセット期間選択機能
- [ ] プリセット期間選択コンポーネントの実装
  - MUI `Button`または`Chip`を使用
  - 今月、先月、今四半期、先四半期、今年、去年などの選択肢
- [ ] プリセット選択時の日付範囲自動設定機能

#### 4.3 統計指標の詳細表示
- [ ] 統計指標パネルの実装
  - MUI `Accordion`または`ExpansionPanel`を使用
- [ ] 基本統計量の表示
  - 平均、中央値、標準偏差、最大値、最小値
- [ ] パーセンタイルの計算と表示
  - 25%、50%（中央値）、75%、90%、95%
- [ ] 前年同月比、前月比の計算（オプション）

#### 4.4 Excelエクスポート機能（オプション）
- [ ] Excelエクスポート機能の実装
  - `xlsx`ライブラリの使用
  - フィルタ適用後のデータをExcel形式でエクスポート
  - 複数シート対応（データ、統計指標など）

#### 4.5 パフォーマンスの最終最適化
- [ ] コード分割と遅延読み込みの実装
  - React `lazy`と`Suspense`の使用
- [ ] メモ化の徹底
  - `React.memo`、`useMemo`、`useCallback`の最適な使用
- [ ] バンドルサイズの最適化
  - 不要なライブラリの削除
  - Tree shakingの確認

#### 4.6 アニメーションとトランジションの完成
- [ ] ページ遷移時のアニメーション
- [ ] グラフ更新時のスムーズなトランジション
- [ ] フィルタ適用時のアニメーション
- [ ] カードのホバーエフェクトの完成

#### 4.7 アクセシビリティの向上
- [ ] キーボード操作のサポート
  - Tabキーでのナビゲーション
  - Enterキーでの操作
- [ ] ARIA属性の追加
  - 適切な`aria-label`、`aria-describedby`の設定
- [ ] スクリーンリーダー対応
  - セマンティックHTMLの使用
- [ ] コントラスト比の確認と調整

#### 4.8 エラーハンドリングの完成
- [ ] すべてのエラーケースのハンドリング
- [ ] ユーザーフレンドリーなエラーメッセージ
- [ ] エラーリカバリー機能
- [ ] エラーログの記録（コンソール）

#### 4.9 ドキュメントの作成
- [ ] README.mdの作成
  - プロジェクトの概要
  - セットアップ手順
  - 使用方法
  - 技術スタック
- [ ] コンポーネントドキュメントの作成
  - 各コンポーネントの説明
  - Propsの説明
- [ ] ユーザーガイドの作成（オプション）

#### 4.10 最終テストとバグ修正
- [ ] 全機能の統合テスト
- [ ] ブラウザ互換性テスト
  - Chrome、Firefox、Safari、Edgeでの動作確認
- [ ] パフォーマンステスト
  - データ読み込み時間の測定
  - フィルタ適用速度の測定
  - メモリ使用量の確認
- [ ] バグの修正と品質向上

### 成果物
- 完全な機能を持つプロダクションレベルのダッシュボード
- すべての要件を満たす実装
- 適切なドキュメント
- 高品質なコード

### テスト項目
- [ ] すべての機能の正常動作
- [ ] グラフエクスポート機能の動作確認
- [ ] Excelエクスポート機能の動作確認（実装した場合）
- [ ] プリセット期間選択の動作確認
- [ ] 統計指標の正確性確認
- [ ] アクセシビリティテスト
- [ ] パフォーマンステスト
- [ ] ブラウザ互換性テスト

---

## 開発の進め方

### 各フェーズの進め方

1. **フェーズ開始前**
   - フェーズの目標と実装する機能を確認
   - 必要な技術調査を行う
   - 実装順序を決定

2. **実装中**
   - 小さな単位で実装とテストを繰り返す
   - 各機能の実装が完了したら、動作確認を行う
   - コードレビューを実施（可能な場合）

3. **フェーズ完了時**
   - 成果物の動作確認
   - テスト項目の確認
   - 次のフェーズへの準備

### 推奨される実装順序

各フェーズ内での実装順序は以下の通りです：

1. **データ層**: データ読み込み、状態管理
2. **UI層**: レイアウト、コンポーネント
3. **機能層**: フィルタリング、可視化、テーブル
4. **UX層**: エラーハンドリング、ローディング、アニメーション

### 注意事項

- 各フェーズで動作する状態を保つ
- コードの品質を維持する（リファクタリングを適宜実施）
- テストを忘れずに実施する
- ドキュメントを適宜更新する

---

## 技術スタック

### 必須パッケージ

```json
{
  "dependencies": {
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@mui/material": "^5.0.0",
    "@mui/icons-material": "^5.0.0",
    "@emotion/react": "^11.0.0",
    "@emotion/styled": "^11.0.0",
    "@mui/x-data-grid": "^6.0.0",
    "@mui/x-date-pickers": "^6.0.0",
    "recharts": "^2.0.0",
    "papaparse": "^5.0.0",
    "dayjs": "^1.11.0"
  }
}
```

### 開発ツール

- Node.js 18.x以上
- npm/yarn/pnpm
- Vite（推奨）またはCreate React App
- ESLint
- Prettier

---

## トラブルシューティング

### よくある問題と解決方法

1. **MUIのスタイルが適用されない**
   - `@emotion/react`と`@emotion/styled`がインストールされているか確認
   - `ThemeProvider`が正しく設定されているか確認

2. **Date Pickersが動作しない**
   - `dayjs`がインストールされているか確認
   - `LocalizationProvider`が設定されているか確認

3. **DataGridが表示されない**
   - `@mui/x-data-grid`がインストールされているか確認
   - ライセンスの問題がないか確認（Community版を使用）

4. **グラフが表示されない**
   - Rechartsが正しくインストールされているか確認
   - データの形式が正しいか確認

---

## 参考資料

- [MUI公式ドキュメント](https://mui.com/)
- [Recharts公式ドキュメント](https://recharts.org/)
- [PapaParse公式ドキュメント](https://www.papaparse.com/)
- [Day.js公式ドキュメント](https://day.js.org/)

---

**作成日**: 2025年1月
**バージョン**: 1.0
**作成者**: AI Assistant

