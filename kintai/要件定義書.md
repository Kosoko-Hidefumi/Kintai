# 勤怠管理・掲示板システム 要件定義書（Streamlit版）

## 1. システム概要

Googleスプレッドシートをデータベース（バックエンド）として活用し、Streamlitで構築したフロントエンドから職員5名の勤怠管理と情報共有を行うWebアプリケーション。

## 2. ユーザーロールと表示制御

セキュリティと誤操作防止のため、ログインユーザー（または選択ユーザー）に応じてメニューを制御する。

### 一般職員モード
- カレンダー閲覧
- 自身の休暇申請
- 掲示板の閲覧・投稿

### 管理者モード
一般機能に加え、以下を利用可能：
- 全職員の集計ダッシュボード
- データの修正・削除権限
- マスタ管理

### 制御方法
管理者パスワード入力、または特定アカウント選択時のみ「管理者用メニュー」をサイドバーに出現させる。

## 3. 機能要件

### A. カレンダー表示機能

- **UI**: Googleカレンダー風の月間表示
- **内容**: 全員の休暇予定（イベント）を表示
- **色分け**: 休暇種別（年休・夏休み・代休）ごとに視覚的に区別
- **詳細**: 予定をクリック（またはホバー）で「13:00-17:00」等の詳細な時間と備考を表示

### B. 勤怠登録・管理機能

- **入力形式**: 日付、休暇種別、開始時間、終了時間、備考
- **時間計算**: 終了時間 － 開始時間（例：13:00-17:00 ＝ 4時間）
- **日数換算**: 取得時間 ÷ 8時間（例：4時間 ＝ 0.5日）
- **修正・削除**:
  - 各予定にはユニークIDを自動付与
  - IDを照合して、スプレッドシートの該当行を正確に上書き・削除
  - 削除時は確認ダイアログを表示する

### C. 掲示板機能

- **投稿**: タイトルと本文を入力
- **日時と投稿者**: システムが自動付与
- **表示順**: 最新の投稿が常に一番上に来るよう、取得時に「投稿日時」で降順ソート
- **体裁**: 視認性の高いカード型レイアウト

### D. 管理者用集計ダッシュボード

- **年度設定**: 7月1日 〜 翌年6月30日
- **集計ロジック**:
  - 常にスプレッドシートの生データ（RAWデータ）から合計値を再計算する（集計ミス防止）
  - 年度判定：月が7以上ならその年、6以下なら前年を「年度」の基準とする
- **表示項目**: 職員別の年休・夏休み・代休の「月間取得数」「年度内累計」「残り日数」

## 4. データ構造（Googleスプレッドシート設計）

### ① 勤怠ログ・シート (attendance_logs)

| 項目 | 説明 |
|------|------|
| event_id | 重複しない固有ID（修正・削除用キー） |
| date | 休暇取得日 |
| staff_name | 職員名 |
| type | 休暇種別（年休/夏休み/代休） |
| start_time | 開始時刻（HH:MM） |
| end_time | 終了時刻（HH:MM） |
| duration_hours | 取得時間（自動計算） |
| day_equivalent | 日数換算（時間/8） |
| fiscal_year | 判定された年度（7月起点） |
| remarks | 備考 |

### ② 掲示板シート (bulletin_board)

| 項目 | 説明 |
|------|------|
| timestamp | 投稿日時（ソート用キー） |
| author | 投稿者名 |
| title | タイトル |
| content | 本文 |

## 5. ロジックと安全性への配慮

### データ整合性の保持

累計値をスプレッドシートに書き込むのではなく、表示のたびに SUMIF や pandas で全行を集計する。これにより、データの修正・削除が即座に合計値へ反映され、カウントミスが発生しない。

### 排他制御の代替案

5名という少人数のため、同時編集による衝突リスクは低いが、更新時は「一度全データを読み込んでからID一致行を特定し、一括で書き戻す」処理を行うことで整合性を担保する。

## 6. 技術スタック

- **言語**: Python 3.x
- **フレームワーク**: Streamlit
- **DB**: Google Sheets (Google Sheets API / gspread)
- **主要ライブラリ**:
  - pandas (集計用)
  - streamlit-calendar (カレンダー描画用)
