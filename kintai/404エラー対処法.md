# 404エラー対処法

「スプレッドシートの取得に失敗しました: <Response [404]>」エラーが発生した場合の対処法です。

## エラーの原因

404エラーは、以下のいずれかが原因です：

1. **スプレッドシートIDが間違っている**
2. **サービスアカウントにスプレッドシートへのアクセス権限がない**（最も多い原因）
3. **スプレッドシートが存在しない、または削除された**

## 確認手順

### ステップ1: スプレッドシートIDの確認

1. スプレッドシートを開く
2. URLを確認：
   ```
   https://docs.google.com/spreadsheets/d/[ここがID]/edit
   ```
3. アプリのサイドバーに入力されているIDと一致しているか確認

**あなたのスプレッドシートID:**
```
17s4l6eflZp74ZuiwIs7VJ4lc40JIRcobxl7PL9i1wDE
```

### ステップ2: サービスアカウントへの権限付与（重要）

**これが最も重要なステップです！**

1. スプレッドシートを開く
2. 右上の「**共有**」ボタンをクリック
3. 「ユーザーやグループを追加」欄に、以下のメールアドレスを入力：
   ```
   id-165@arctic-badge-484907-n8.iam.gserviceaccount.com
   ```
4. **権限を「編集者」に設定**
5. 「**送信**」をクリック
   - ⚠️ **注意**: 「リンクを知っている全員に通知」のチェックは**外す**

### ステップ3: 権限の確認

1. スプレッドシートの「共有」設定を再度開く
2. 以下のメールアドレスがリストに表示されているか確認：
   ```
   id-165@arctic-badge-484907-n8.iam.gserviceaccount.com
   ```
3. 権限が「編集者」になっているか確認

### ステップ4: アプリの再読み込み

1. ブラウザでアプリをリロード（F5キー）
2. サイドバーでスプレッドシートIDが正しく入力されているか確認
3. 再度休暇申請を試す

## よくある間違い

### ❌ 間違い1: メールアドレスの入力ミス
```
id-165@arctic-badge-484907-n8.iam.gserviceaccount.com
```
- スペースが入っていないか
- 大文字小文字が正しいか
- `@` や `.` が正しいか

### ❌ 間違い2: 権限が「閲覧者」になっている
- 「編集者」である必要があります
- 「閲覧者」では書き込みができません

### ❌ 間違い3: スプレッドシートIDのコピーミス
- URL全体をコピーしていないか
- `/edit` 以降の部分が含まれていないか
- スペースが入っていないか

## トラブルシューティング

### 問題1: 共有設定でメールアドレスが見つからない

**解決法:**
- メールアドレスを正確にコピー&ペースト
- 手動で入力する場合は、1文字ずつ確認

### 問題2: 権限を付与したのにエラーが続く

**解決法:**
1. 数秒待ってから再度試す（反映に時間がかかる場合があります）
2. ブラウザのキャッシュをクリア
3. アプリを再起動

### 問題3: スプレッドシートIDを変更した

**解決法:**
1. 新しいスプレッドシートにもサービスアカウントの権限を付与
2. アプリのサイドバーで新しいIDを入力

## 確認チェックリスト

- [ ] スプレッドシートIDが正しい
- [ ] サービスアカウントのメールアドレスが正しい
- [ ] スプレッドシートの「共有」設定でメールアドレスが追加されている
- [ ] 権限が「編集者」になっている
- [ ] アプリをリロードした
- [ ] スプレッドシートに `attendance_logs` と `bulletin_board` シートが存在する

## それでも解決しない場合

1. **エラーメッセージの全文を確認**
   - アプリに表示されているエラーメッセージを確認
   - より詳細な情報が表示されるようになりました

2. **ターミナルのログを確認**
   - Streamlitアプリを起動しているターミナルにエラーが表示されていないか確認

3. **認証情報の確認**
   - `.streamlit/secrets.toml` が正しく設定されているか確認
   - `convert_json_to_toml.py` で変換したファイルが正しいか確認

## 成功の確認

正常に動作すると：
- ✅ 休暇申請フォームで「休暇申請が正常に登録されました！」と表示される
- ✅ カレンダーページでデータが表示される
- ✅ 掲示板ページで投稿が表示される
